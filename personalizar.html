<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personalizar Producto</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .personalizacion-container {
      max-width: 600px;
      margin: 2em auto;
      padding: 1em;
    }
    .producto-header {
      background: #2c3e50;
      color: white;
      padding: 2em;
      border-radius: 10px;
      text-align: center;
      margin-bottom: 2em;
    }
    .ajustes-seccion {
      background: #34495e;
      padding: 2em;
      border-radius: 10px;
      margin-bottom: 2em;
      color: white;
    }
    .ajuste-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
      margin: 0.5em 0;
      background: #2c3e50;
      border-radius: 8px;
    }
    .ajuste-info {
      display: flex;
      align-items: center;
      gap: 1em;
    }
    .ajuste-emoji {
      font-size: 1.5em;
    }
    .ajuste-nombre {
      font-weight: bold;
    }
    .ajuste-descripcion {
      color: #bdc3c7;
      font-size: 0.9em;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #4CAF50;
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    .vasos-seccion {
      background: #8e44ad;
      padding: 2em;
      border-radius: 10px;
      margin-bottom: 2em;
      color: white;
    }
    .vaso-option {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1em;
      margin: 0.5em 0;
      background: #9b59b6;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .vaso-option:hover {
      background: #a569bd;
    }
    .vaso-option.selected {
      background: #27ae60;
      border: 2px solid #2ecc71;
    }
    .vaso-info {
      display: flex;
      align-items: center;
      gap: 1em;
    }
    .vaso-precio {
      font-weight: bold;
      color: #f1c40f;
    }
    .precio-total {
      background: #27ae60;
      color: white;
      padding: 1.5em;
      border-radius: 10px;
      text-align: center;
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 1em;
    }
    .botones-container {
      display: flex;
      gap: 1em;
      justify-content: center;
    }
    .boton {
      padding: 1em 2em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      font-weight: bold;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      transition: all 0.3s;
    }
    .boton-volver {
      background: #95a5a6;
      color: white;
    }
    .boton-volver:hover {
      background: #7f8c8d;
    }
    .boton-continuar {
      background: #3498db;
      color: white;
    }
    .boton-continuar:hover {
      background: #2980b9;
    }
  </style>
</head>
<body>
  <div class="personalizacion-container">
    <div class="producto-header">
      <div id="productoEmoji" style="font-size: 3em; margin-bottom: 0.5em;">üçÉ</div>
      <h1 id="productoNombre">Mojito</h1>
      <p id="productoDescripcion">Personaliza tu producto</p>
    </div>

    <div class="ajustes-seccion">
      <h2 style="margin-top: 0;">üõ†Ô∏è Ajustar Ingredientes</h2>
      <div id="ajustesLista">
        <!-- Los ajustes se cargar√°n din√°micamente aqu√≠ -->
      </div>
    </div>

    <div class="vasos-seccion">
      <h2 style="margin-top: 0;">ü•§ Seleccionar Vaso/Envase</h2>
      <div id="vasosLista">
        <!-- Los vasos se cargar√°n din√°micamente aqu√≠ -->
      </div>
    </div>

    <div class="precio-total">
      üí∞ Precio Final: ‚Ç¨<span id="precioTotal">4.50</span>
    </div>

    <div class="botones-container">
      <button id="botonVolver" class="boton boton-volver">‚Üê Volver</button>
      <button id="botonContinuar" class="boton boton-continuar">Confirmar Venta ‚Üí</button>
    </div>
  </div>

  <script>
    // Configuraci√≥n de productos preparados simplificada
    const PRODUCTOS_PREPARADOS = {
      mojito: {
        nombre: "Mojito",
        emoji: "üçÉ",
        descripcion: "C√≥ctel refrescante personalizable",
        costo: 3.00,
        beneficio: 1.50, // Beneficio fijo
        ajustes: [
          {
            id: "ron_blanco",
            nombre: "Ron Blanco",
            emoji: "ü•É",
            descripcion: "Base del mojito",
            porDefecto: true  // INCLUIDO por defecto
          },
          {
            id: "menta_fresca",
            nombre: "Menta Fresca",
            emoji: "üçÉ",
            descripcion: "Hojas de menta arom√°ticas",
            porDefecto: true  // INCLUIDO por defecto
          },
          {
            id: "lima",
            nombre: "Lima",
            emoji: "üü¢",
            descripcion: "Jugo de lima fresco",
            porDefecto: true  // INCLUIDO por defecto
          },
          {
            id: "azucar_blanco",
            nombre: "Az√∫car Blanco",
            emoji: "üßÇ",
            descripcion: "Az√∫car para endulzar",
            porDefecto: true  // INCLUIDO por defecto
          },
          {
            id: "agua_gas",
            nombre: "Agua con Gas",
            emoji: "üíß",
            descripcion: "Para completar la bebida",
            porDefecto: true  // INCLUIDO por defecto
          },
          {
            id: "hielo",
            nombre: "Hielo",
            emoji: "üßä",
            descripcion: "Hielo picado fresco",
            porDefecto: true  // INCLUIDO por defecto
          }
        ]
      },
      caipirinha: {
        nombre: "Caipirinha",
        emoji: "üçã",
        descripcion: "C√≥ctel brasile√±o personalizable",
        costo: 3.50,
        beneficio: 1.50,
        ajustes: [
          {
            id: "cachaca",
            nombre: "Cacha√ßa",
            emoji: "ü•É",
            descripcion: "Destilado brasile√±o",
            porDefecto: true
          },
          {
            id: "lima_caipirinha",
            nombre: "Lima",
            emoji: "üü¢",
            descripcion: "Lima fresca cortada",
            porDefecto: true
          },
          {
            id: "azucar_moreno",
            nombre: "Az√∫car Moreno",
            emoji: "ÔøΩ",
            descripcion: "Az√∫car de ca√±a",
            porDefecto: true
          },
          {
            id: "hielo_picado",
            nombre: "Hielo Picado",
            emoji: "üßä",
            descripcion: "Hielo picado fino",
            porDefecto: true
          }
        ]
      },
      sangria: {
        nombre: "Sangr√≠a",
        emoji: "üç∑",
        descripcion: "Bebida tradicional personalizable",
        costo: 2.80,
        beneficio: 1.20,
        ajustes: [
          {
            id: "vino_tinto",
            nombre: "Vino Tinto",
            emoji: "üç∑",
            descripcion: "Base de vino tinto",
            porDefecto: true
          },
          {
            id: "naranja",
            nombre: "Naranja",
            emoji: "ÔøΩ",
            descripcion: "Rodajas de naranja",
            porDefecto: true
          },
          {
            id: "limon",
            nombre: "Lim√≥n",
            emoji: "üçã",
            descripcion: "Rodajas de lim√≥n",
            porDefecto: true
          },
          {
            id: "manzana",
            nombre: "Manzana",
            emoji: "üçé",
            descripcion: "Trozos de manzana",
            porDefecto: true
          },
          {
            id: "azucar_sangria",
            nombre: "Az√∫car",
            emoji: "üßÇ",
            descripcion: "Para endulzar",
            porDefecto: true
          }
        ]
      },
      ensalada_frutas: {
        nombre: "Ensalada de Frutas",
        emoji: "ü•ó",
        descripcion: "Mix de frutas personalizable",
        costo: 2.50,
        beneficio: 1.00,
        ajustes: [
          {
            id: "manzana_ensalada",
            nombre: "Manzana",
            emoji: "üçé",
            descripcion: "Trozos de manzana roja",
            porDefecto: true
          },
          {
            id: "banana_ensalada",
            nombre: "Banana",
            emoji: "üçå",
            descripcion: "Rodajas de banana",
            porDefecto: true
          },
          {
            id: "naranja_ensalada",
            nombre: "Naranja",
            emoji: "ÔøΩ",
            descripcion: "Gajos de naranja",
            porDefecto: true
          },
          {
            id: "uvas_ensalada",
            nombre: "Uvas",
            emoji: "üçá",
            descripcion: "Uvas sin semilla",
            porDefecto: true
          }
        ]
      },
      smoothie: {
        nombre: "Smoothie Natural",
        emoji: "ü•§",
        descripcion: "Batido personalizable",
        costo: 2.80,
        beneficio: 1.20,
        ajustes: [
          {
            id: "base_leche",
            nombre: "Base de Leche",
            emoji: "ü•õ",
            descripcion: "Leche o yogur",
            porDefecto: true
          },
          {
            id: "banana_smoothie",
            nombre: "Banana",
            emoji: "üçå",
            descripcion: "Para cremosidad",
            porDefecto: true
          },
          {
            id: "fresas_smoothie",
            nombre: "Fresas",
            emoji: "üçì",
            descripcion: "Fresas dulces",
            porDefecto: true
          },
          {
            id: "hielo_smoothie",
            nombre: "Hielo",
            emoji: "üßä",
            descripcion: "Hielo para enfriar",
            porDefecto: true
          }
        ]
      },
      mix_frutos: {
        nombre: "Mix de Frutos Secos",
        emoji: "ü•ú",
        descripcion: "Mezcla personalizable",
        costo: 2.20,
        beneficio: 0.80,
        ajustes: [
          {
            id: "almendras",
            nombre: "Almendras",
            emoji: "üå∞",
            descripcion: "Almendras tostadas",
            porDefecto: true
          },
          {
            id: "nueces",
            nombre: "Nueces",
            emoji: "ü•ú",
            descripcion: "Nueces partidas",
            porDefecto: true
          },
          {
            id: "pasas",
            nombre: "Pasas",
            emoji: "ÔøΩ",
            descripcion: "Pasas dulces",
            porDefecto: true
          }
        ]
      },
      sandwich: {
        nombre: "Sandwich Personalizado",
        emoji: "ü•™",
        descripcion: "Sandwich a tu gusto",
        costo: 3.20,
        beneficio: 1.30,
        ajustes: [
          {
            id: "pan_sandwich",
            nombre: "Pan",
            emoji: "üçû",
            descripcion: "Pan fresco",
            porDefecto: true
          },
          {
            id: "jamon",
            nombre: "Jam√≥n",
            emoji: "ü•ì",
            descripcion: "Jam√≥n cocido",
            porDefecto: true
          },
          {
            id: "queso",
            nombre: "Queso",
            emoji: "ÔøΩ",
            descripcion: "Queso fundido",
            porDefecto: true
          },
          {
            id: "lechuga",
            nombre: "Lechuga",
            emoji: "ü•¨",
            descripcion: "Lechuga fresca",
            porDefecto: true
          },
          {
            id: "tomate",
            nombre: "Tomate",
            emoji: "üçÖ",
            descripcion: "Rodajas de tomate",
            porDefecto: true
          },
          {
            id: "mayonesa",
            nombre: "Mayonesa",
            emoji: "ü•Ñ",
            descripcion: "Salsa mayonesa",
            porDefecto: true
          }
        ]
      },
      agua: {
        nombre: "Agua Mineral",
        emoji: "üíß",
        descripcion: "Agua refrescante personalizable",
        costo: 1.00,
        beneficio: 0.50,
        ajustes: [
          {
            id: "agua_fria",
            nombre: "Agua Fr√≠a",
            emoji: "‚ùÑÔ∏è",
            descripcion: "Agua bien fr√≠a",
            porDefecto: true
          },
          {
            id: "hielo_agua",
            nombre: "Hielo Extra",
            emoji: "üßä",
            descripcion: "Cubos de hielo adicionales",
            porDefecto: false
          },
          {
            id: "limon_agua",
            nombre: "Rodaja de Lim√≥n",
            emoji: "üçã",
            descripcion: "Rodaja de lim√≥n fresco",
            porDefecto: false
          }
        ]
      },
      cocacola: {
        nombre: "Coca-Cola",
        emoji: "ü•§",
        descripcion: "Refresco cl√°sico personalizable",
        costo: 1.20,
        beneficio: 0.80,
        ajustes: [
          {
            id: "coca_fria",
            nombre: "Coca-Cola Fr√≠a",
            emoji: "‚ùÑÔ∏è",
            descripcion: "Bien fr√≠a de nevera",
            porDefecto: true
          },
          {
            id: "hielo_coca",
            nombre: "Hielo Extra",
            emoji: "üßä",
            descripcion: "Cubos de hielo adicionales",
            porDefecto: true
          },
          {
            id: "limon_coca",
            nombre: "Rodaja de Lim√≥n",
            emoji: "üçã",
            descripcion: "Un toque c√≠trico",
            porDefecto: false
          }
        ]
      },
      fanta: {
        nombre: "Fanta Naranja",
        emoji: "üçä",
        descripcion: "Refresco de naranja personalizable",
        costo: 1.20,
        beneficio: 0.80,
        ajustes: [
          {
            id: "fanta_fria",
            nombre: "Fanta Fr√≠a",
            emoji: "‚ùÑÔ∏è",
            descripcion: "Bien fr√≠a de nevera",
            porDefecto: true
          },
          {
            id: "hielo_fanta",
            nombre: "Hielo Extra",
            emoji: "üßä",
            descripcion: "Cubos de hielo adicionales",
            porDefecto: true
          },
          {
            id: "naranja_extra",
            nombre: "Rodaja de Naranja",
            emoji: "üçä",
            descripcion: "Rodaja de naranja fresca",
            porDefecto: false
          }
        ]
      },
      fanta: {
        nombre: "Fanta Naranja",
        emoji: "üçä",
        descripcion: "Refresco de naranja personalizable",
        costo: 1.20,
        beneficio: 0.80,
        ajustes: [
          {
            id: "fanta_fria",
            nombre: "Fanta Fr√≠a",
            emoji: "‚ùÑÔ∏è",
            descripcion: "Bien fr√≠a de nevera",
            porDefecto: true
          },
          {
            id: "hielo_fanta",
            nombre: "Hielo Extra",
            emoji: "üßä",
            descripcion: "Cubos de hielo adicionales",
            porDefecto: true
          },
          {
            id: "naranja_extra",
            nombre: "Rodaja de Naranja",
            emoji: "üçä",
            descripcion: "Rodaja de naranja fresca",
            porDefecto: false
          }
        ]
      },
      sprite: {
        nombre: "Sprite",
        emoji: "üü¢",
        descripcion: "Refresco de lima-lim√≥n personalizable",
        costo: 1.40,
        beneficio: 0.90,
        ajustes: [
          {
            id: "sprite_frio",
            nombre: "Sprite Fr√≠o",
            emoji: "‚ùÑÔ∏è",
            descripcion: "Bien fr√≠o de nevera",
            porDefecto: true
          },
          {
            id: "hielo_sprite",
            nombre: "Hielo Extra",
            emoji: "üßä",
            descripcion: "Cubos de hielo adicionales",
            porDefecto: true
          },
          {
            id: "limon_sprite",
            nombre: "Rodaja de Lim√≥n",
            emoji: "üçã",
            descripcion: "Un toque c√≠trico extra",
            porDefecto: false
          }
        ]
      },
      manzana: {
        nombre: "Manzana",
        emoji: "üçé",
        descripcion: "Manzana fresca personalizable",
        costo: 0.70,
        beneficio: 0.50,
        ajustes: [
          {
            id: "manzana_lavada",
            nombre: "Manzana Lavada",
            emoji: "üçé",
            descripcion: "Bien lavada y lista",
            porDefecto: true
          },
          {
            id: "manzana_cortada",
            nombre: "Cortada en Trozos",
            emoji: "üî™",
            descripcion: "Cortada en trozos peque√±os",
            porDefecto: false
          },
          {
            id: "sal_fruta",
            nombre: "Sal de Fruta",
            emoji: "üßÇ",
            descripcion: "Pizca de sal especial",
            porDefecto: false
          }
        ]
      },
      banana: {
        nombre: "Banana",
        emoji: "üçå",
        descripcion: "Banana fresca personalizable",
        costo: 0.50,
        beneficio: 0.30,
        ajustes: [
          {
            id: "banana_pelada",
            nombre: "Banana Pelada",
            emoji: "üçå",
            descripcion: "Lista para comer",
            porDefecto: true
          },
          {
            id: "banana_cortada",
            nombre: "Cortada en Rodajas",
            emoji: "üî™",
            descripcion: "Cortada en rodajas",
            porDefecto: false
          }
        ]
      },
      naranja: {
        nombre: "Naranja",
        emoji: "üçä",
        descripcion: "Naranja fresca personalizable",
        costo: 0.60,
        beneficio: 0.40,
        ajustes: [
          {
            id: "naranja_pelada",
            nombre: "Naranja Pelada",
            emoji: "üçä",
            descripcion: "Pelada y lista",
            porDefecto: true
          },
          {
            id: "naranja_gajos",
            nombre: "Separada en Gajos",
            emoji: "üî™",
            descripcion: "Separada en gajos",
            porDefecto: false
          }
        ]
      },
      papitas: {
        nombre: "Papitas Fritas",
        emoji: "üçü",
        descripcion: "Papitas crujientes personalizables",
        costo: 1.20,
        beneficio: 0.60,
        ajustes: [
          {
            id: "papitas_sal",
            nombre: "Con Sal",
            emoji: "üßÇ",
            descripcion: "Sal cl√°sica",
            porDefecto: true
          },
          {
            id: "papitas_ketchup",
            nombre: "Ketchup",
            emoji: "üçÖ",
            descripcion: "Salsa de tomate",
            porDefecto: false
          },
          {
            id: "papitas_mayo",
            nombre: "Mayonesa",
            emoji: "ü•Ñ",
            descripcion: "Mayonesa cremosa",
            porDefecto: false
          }
        ]
      },
      chocolate: {
        nombre: "Chocolate",
        emoji: "üç´",
        descripcion: "Chocolate personalizable",
        costo: 1.50,
        beneficio: 0.70,
        ajustes: [
          {
            id: "chocolate_entero",
            nombre: "Chocolate Entero",
            emoji: "üç´",
            descripcion: "Tableta completa",
            porDefecto: true
          },
          {
            id: "chocolate_trozos",
            nombre: "En Trozos",
            emoji: "üî™",
            descripcion: "Troceado para compartir",
            porDefecto: false
          }
        ]
      },
      galletas: {
        nombre: "Galletas",
        emoji: "üç™",
        descripcion: "Galletas personalizables",
        costo: 1.00,
        beneficio: 0.50,
        ajustes: [
          {
            id: "galletas_pack",
            nombre: "Pack de Galletas",
            emoji: "üç™",
            descripcion: "Pack completo",
            porDefecto: true
          },
          {
            id: "leche_galletas",
            nombre: "Con Leche",
            emoji: "ü•õ",
            descripcion: "Vaso de leche para mojar",
            porDefecto: false
          }
        ]
      },
      croissant: {
        nombre: "Croissant",
        emoji: "ü•ê",
        descripcion: "Croissant personalizable",
        costo: 1.80,
        beneficio: 0.70,
        ajustes: [
          {
            id: "croissant_simple",
            nombre: "Croissant Simple",
            emoji: "ü•ê",
            descripcion: "Natural y delicioso",
            porDefecto: true
          },
          {
            id: "mermelada",
            nombre: "Con Mermelada",
            emoji: "üçì",
            descripcion: "Mermelada de fresa",
            porDefecto: false
          },
          {
            id: "mantequilla",
            nombre: "Con Mantequilla",
            emoji: "üßà",
            descripcion: "Mantequilla fresca",
            porDefecto: false
          }
        ]
      },
      pan_tostado: {
        nombre: "Pan Tostado",
        emoji: "üçû",
        descripcion: "Pan tostado personalizable",
        costo: 1.20,
        beneficio: 0.60,
        ajustes: [
          {
            id: "pan_tostado_simple",
            nombre: "Pan Tostado",
            emoji: "üçû",
            descripcion: "Tostado perfecto",
            porDefecto: true
          },
          {
            id: "tomate_pan",
            nombre: "Con Tomate",
            emoji: "üçÖ",
            descripcion: "Tomate rallado",
            porDefecto: false
          },
          {
            id: "aceite_pan",
            nombre: "Con Aceite",
            emoji: "ü´í",
            descripcion: "Aceite de oliva",
            porDefecto: false
          }
        ]
      },
      muffin: {
        nombre: "Muffin",
        emoji: "üßÅ",
        descripcion: "Muffin personalizable",
        costo: 2.00,
        beneficio: 0.80,
        ajustes: [
          {
            id: "muffin_simple",
            nombre: "Muffin",
            emoji: "üßÅ",
            descripcion: "Muffin esponjoso",
            porDefecto: true
          },
          {
            id: "muffin_calentado",
            nombre: "Calentado",
            emoji: "üî•",
            descripcion: "Calentado en microondas",
            porDefecto: false
          }
        ]
      },
      set_vasos: {
        nombre: "Set de Vasos",
        emoji: "ü•§",
        descripcion: "Pack personalizable de vasos",
        costo: 2.50,
        beneficio: 1.50,
        ajustes: [
          {
            id: "vaso_basico_set",
            nombre: "Vaso B√°sico x2",
            emoji: "ü•§",
            descripcion: "2 vasos b√°sicos incluidos",
            porDefecto: true
          },
          {
            id: "vaso_premium_set",
            nombre: "Vaso Premium x1",
            emoji: "üç∑",
            descripcion: "1 vaso premium adicional",
            porDefecto: false
          },
          {
            id: "vaso_ecologico_set",
            nombre: "Vaso Ecol√≥gico x1",
            emoji: "üå±",
            descripcion: "1 vaso ecol√≥gico adicional",
            porDefecto: false
          },
          {
            id: "envase_extra",
            nombre: "Envase para Comida",
            emoji: "üì¶",
            descripcion: "Envase adicional incluido",
            porDefecto: false
          }
        ]
      }
    };

    // Configuraci√≥n de vasos/envases
    const VASOS_CONFIG = [
      {
        id: "basico",
        nombre: "Vaso B√°sico",
        emoji: "ü•§",
        descripcion: "Vaso est√°ndar incluido",
        ajuste: 0.00,
        porDefecto: true
      },
      {
        id: "premium",
        nombre: "Vaso Premium",
        emoji: "üç∑",
        descripcion: "Vaso de mejor calidad",
        ajuste: +0.50
      },
      {
        id: "ecologico",
        nombre: "Vaso Ecol√≥gico",
        emoji: "üå±",
        descripcion: "Vaso biodegradable",
        ajuste: +0.30
      },
      {
        id: "sin_vaso",
        nombre: "Sin Vaso",
        emoji: "üö´",
        descripcion: "Cliente trae su propio vaso",
        ajuste: -0.20
      }
    ];

    // Variables globales
    let currentProducto = null;
    let currentCategoria = null;
    let currentProductoId = null;
    let vasoSeleccionado = "basico";

    // Configuraci√≥n de API centralizada
    const API_CONFIG = {
      baseURL: 'http://localhost:5001',
      getAPIEndpoint: function(endpoint) {
        return `${this.baseURL}/api/${endpoint}`;
      }
    };

    // Obtener par√°metros de la URL
    function obtenerParametrosURL() {
      const urlParams = new URLSearchParams(window.location.search);
      currentCategoria = urlParams.get('categoria');
      currentProductoId = urlParams.get('producto');
    }

    // Cargar configuraci√≥n del producto
    function cargarProducto() {
      currentProducto = PRODUCTOS_PREPARADOS[currentProductoId];
      if (!currentProducto) {
        alert('Producto no encontrado');
        window.history.back();
        return;
      }

      // Actualizar header
      document.getElementById('productoEmoji').textContent = currentProducto.emoji;
      document.getElementById('productoNombre').textContent = currentProducto.nombre;
      document.getElementById('productoDescripcion').textContent = currentProducto.descripcion;

      // Cargar ajustes y vasos
      cargarAjustes();
      cargarVasos();
      calcularPrecioTotal();
    }

    // Cargar lista de ajustes
    function cargarAjustes() {
      const container = document.getElementById('ajustesLista');
      container.innerHTML = '';

      currentProducto.ajustes.forEach(ajuste => {
        const ajusteDiv = document.createElement('div');
        ajusteDiv.className = 'ajuste-item';
        
        ajusteDiv.innerHTML = `
          <div class="ajuste-info">
            <div class="ajuste-emoji">${ajuste.emoji}</div>
            <div>
              <div class="ajuste-nombre">${ajuste.nombre}</div>
              <div class="ajuste-descripcion">${ajuste.descripcion}</div>
            </div>
          </div>
          <label class="switch">
            <input type="checkbox" id="ajuste-${ajuste.id}" ${ajuste.porDefecto ? 'checked' : ''} onchange="calcularPrecioTotal()">
            <span class="slider"></span>
          </label>
        `;

        container.appendChild(ajusteDiv);
      });
    }

    // Cargar opciones de vasos
    function cargarVasos() {
      const container = document.getElementById('vasosLista');
      container.innerHTML = '';

      VASOS_CONFIG.forEach(vaso => {
        const vasoDiv = document.createElement('div');
        vasoDiv.className = `vaso-option ${vaso.porDefecto ? 'selected' : ''}`;
        vasoDiv.onclick = () => seleccionarVaso(vaso.id);
        
        const precioTexto = vaso.ajuste === 0 ? 'Incluido' : 
                           vaso.ajuste > 0 ? `+‚Ç¨${vaso.ajuste.toFixed(2)}` : 
                           `‚Ç¨${vaso.ajuste.toFixed(2)}`;
        
        vasoDiv.innerHTML = `
          <div class="vaso-info">
            <div style="font-size: 1.5em;">${vaso.emoji}</div>
            <div>
              <div style="font-weight: bold;">${vaso.nombre}</div>
              <div style="color: #ecf0f1; font-size: 0.9em;">${vaso.descripcion}</div>
            </div>
          </div>
          <div class="vaso-precio">${precioTexto}</div>
        `;

        container.appendChild(vasoDiv);
      });
    }

    // Seleccionar vaso
    function seleccionarVaso(vasoId) {
      vasoSeleccionado = vasoId;
      
      // Actualizar interfaz
      document.querySelectorAll('.vaso-option').forEach(option => {
        option.classList.remove('selected');
      });
      event.currentTarget.classList.add('selected');
      
      calcularPrecioTotal();
    }

    // Calcular precio total
    function calcularPrecioTotal() {
      const precioBase = currentProducto.costo + currentProducto.beneficio;
      
      // Ajuste del vaso
      const vaso = VASOS_CONFIG.find(v => v.id === vasoSeleccionado);
      const ajusteVaso = vaso ? vaso.ajuste : 0;
      
      const total = precioBase + ajusteVaso;
      document.getElementById('precioTotal').textContent = total.toFixed(2);
    }

    // Obtener configuraci√≥n seleccionada
    function obtenerConfiguracion() {
      const ajustesSeleccionados = [];
      
      currentProducto.ajustes.forEach(ajuste => {
        const checkbox = document.getElementById(`ajuste-${ajuste.id}`);
        if (checkbox && checkbox.checked) {
          ajustesSeleccionados.push(ajuste.nombre);
        }
      });

      const vaso = VASOS_CONFIG.find(v => v.id === vasoSeleccionado);
      
      return {
        ajustes: ajustesSeleccionados,
        vaso: vaso.nombre,
        vasoAjuste: vaso.ajuste
      };
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      obtenerParametrosURL();
      cargarProducto();

      // Bot√≥n volver
      document.getElementById('botonVolver').onclick = () => {
        window.location.href = `productos.html?categoria=${currentCategoria}`;
      };

      // Bot√≥n continuar - ir directo a confirmar venta
      document.getElementById('botonContinuar').onclick = () => {
        const config = obtenerConfiguracion();
        const precioFinal = parseFloat(document.getElementById('precioTotal').textContent);
        
        // Crear objeto de venta directa
        const venta = {
          fecha: new Date().toISOString(),
          categoria: currentCategoria,
          producto: currentProducto.nombre,
          emoji: currentProducto.emoji,
          costo: currentProducto.costo,
          beneficio: currentProducto.beneficio,
          precioFinal: precioFinal,
          tipo: 'preparado',
          ajustes: config.ajustes,
          vaso: config.vaso,
          vasoAjuste: config.vasoAjuste
        };

        // Enviar al servidor
        fetch(API_CONFIG.getAPIEndpoint('ventas'), {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(venta)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(`¬°Venta confirmada!\n${currentProducto.emoji} ${currentProducto.nombre}\nPrecio final: ‚Ç¨${precioFinal.toFixed(2)}\nVaso: ${config.vaso}`);
            window.location.href = 'index.html';
          } else {
            alert('Error al registrar la venta: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error de conexi√≥n. Verifica que el servidor est√© funcionando.');
        });
      };
    });
  </script>
</body>
</html>